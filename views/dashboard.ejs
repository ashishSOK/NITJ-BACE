<h1 class="text-3xl font-bold text-iskcon-orange mb-6">Welcome, <%= user.name %></h1>

<!-- Admin Quick Actions -->
<% if (user && user.role === 'admin') { %>
  <div class="card mb-6 p-4 border-l-4 border-iskcon-orange bg-yellow-50">
    <h3 class="text-lg font-semibold text-iskcon-blue">Admin Quick Actions</h3>
    <div class="mt-3 flex flex-wrap gap-3">
      <a href="/admin/seva" class="btn btn-primary px-4 py-2">Assign Seva</a>
      <a href="/admin/payments" class="btn btn-ghost px-4 py-2">Payment Requests</a>
      <a href="/admin/rent" class="btn btn-ghost px-4 py-2">Manage Rent</a>
      <a href="/admin/members" class="btn btn-ghost px-4 py-2">Members</a>
    </div>
  </div>
<% } %>

<div class="dashboard-grid grid grid-cols-1 md:grid-cols-3 gap-6">
  <!-- Sadhana Card -->
  <div class="card p-4">
    <h2 class="text-xl font-semibold mb-3 text-iskcon-blue">Sadhana</h2>
    <% if (sadhana && sadhana.length) { %>
      <% sadhana.forEach(log => { %>
        <p class="mb-1 text-sm">
          <strong><%= new Date(log.date).toLocaleDateString() %></strong> • Wake: <%= log.wakeupTime %> • BG: <%= log.bgStudyHours %> hrs
        </p>
      <% }) %>
    <% } else { %>
      <p class="text-gray-600 mb-3">No sadhana logs yet.</p>
    <% } %>
    <form id="sadhana-form" action="/sadhana" method="POST" class="mt-4 space-y-2">
      <input type="date" name="date" required class="p-2 border rounded w-full" />
      <input type="time" name="wakeupTime" required class="p-2 border rounded w-full" />
      <input type="time" name="sleepTime" class="p-2 border rounded w-full" />
      <input type="number" name="bgStudyHours" step="0.1" min="0" placeholder="BG Study Hours" required class="p-2 border rounded w-full" />
      <button type="submit" class="w-full bg-iskcon-orange text-white p-2 rounded hover:opacity-95">Log Sadhana</button>
    </form>
  </div>

  <!-- Seva Card -->
  <div class="card p-4">
    <h2 class="text-xl font-semibold mb-3 text-iskcon-blue">Seva</h2>
   <% if (seva && seva.length) { %>
  <% seva.forEach(task => { %>
    <div class="mb-3 p-2 rounded border bg-gray-50">
      <p class="font-medium"><%= task.type %></p>
      <p class="text-sm text-gray-600">
        <%= new Date(task.date).toLocaleDateString() %> • <%= task.timeSlot || '—' %>
      </p>

      <% if (user.role === 'admin') { %>
        <p class="text-xs text-gray-500">
          Assigned to: <%= task.user ? task.user.name : 'Unknown' %>
          (<%= task.user ? task.user.email : '' %>)
        </p>
      <% } %>

      <% if (task.status !== 'completed' && user.role !== 'admin') { %>
        <form action="/seva/<%= task._id %>/status" method="POST" class="mt-2">
          <input type="hidden" name="status" value="completed" />
          <button class="btn btn-ghost w-full" type="submit">Mark as Done</button>
        </form>
      <% } else if (task.status === 'completed') { %>
        <span class="text-green-600 font-semibold">Completed</span>
      <% } %>
    </div>
  <% }) %>
<% } else { %>
  <p class="text-gray-600">No seva assigned yet.</p>
<% } %>

  </div>

  <!-- Rent Card -->
  <div class="card p-4">
    <h2 class="text-xl font-semibold mb-3 text-iskcon-blue">Rent Status</h2>
    <p><strong>Due:</strong> ₹<%= (rent && rent.remaining) ? rent.remaining : (rent.totalDue || 30000) %></p>
    <p><strong>Paid:</strong> ₹<%= (rent && rent.paid) ? rent.paid: 0 %></p>
    <p class="mb-4"><strong>Paid Until:</strong> <%= (rent && rent.paidUntil) ? new Date(rent.paidUntil).toLocaleDateString() : 'N/A' %></p>

    <!-- Member: Request payment -->
    <% if (user && user.role !== 'admin') { %>
      <form action="/payments/request" method="POST" class="space-y-2">
        <input type="number" name="amount" min="1" placeholder="Enter Amount (₹)" required class="w-full p-2 border rounded" />
        <select name="method" class="w-full p-2 border rounded">
          <option value="upi">UPI</option>
          <option value="cash">Cash</option>
          <option value="bank">Bank</option>
          <option value="other">Other</option>
        </select>
        <input type="text" name="note" placeholder="Note (optional)" class="w-full p-2 border rounded" />
        <button type="submit" class="w-full bg-iskcon-blue text-white p-2 rounded hover:opacity-95">Request Payment</button>
      </form>
    <% } %>

    <!-- Admin quick rent link -->
    <% if (user && user.role === 'admin') { %>
      <div class="mt-4 border-t pt-3">
        <a href="/admin/rent" class="btn btn-ghost w-full">Open Rent Admin</a>
      </div>
    <% } %>
  </div>
</div>

<div class="mt-6">
  <a href="/rankings" class="inline-block bg-iskcon-blue text-white px-4 py-2 rounded hover:opacity-95">Show Weekly Rankings</a>
</div>
